"use strict";var _as=(()=>{var qr=Object.create;var gt=Object.defineProperty;var Vr=Object.getOwnPropertyDescriptor;var $r=Object.getOwnPropertyNames;var Jr=Object.getPrototypeOf,Yr=Object.prototype.hasOwnProperty;var Bo=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),Xr=(s,e)=>{for(var t in e)gt(s,t,{get:e[t],enumerable:!0})},Wo=(s,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of $r(e))!Yr.call(s,r)&&r!==t&&gt(s,r,{get:()=>e[r],enumerable:!(o=Vr(e,r))||o.enumerable});return s};var te=(s,e,t)=>(t=s!=null?qr(Jr(s)):{},Wo(e||!s||!s.__esModule?gt(t,"default",{value:s,enumerable:!0}):t,s)),Zr=s=>Wo(gt({},"__esModule",{value:!0}),s);var oe=Bo((Ut,Xo)=>{(function(s,e){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],e);else if(typeof Ut<"u")e(Xo);else{var t={exports:{}};e(t),s.browser=t.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Ut,function(s){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let e="The message port closed before a response was received.",t=o=>{let r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(r).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class i extends WeakMap{constructor(f,w=void 0){super(w),this.createItem=f}get(f){return this.has(f)||this.set(f,this.createItem(f)),super.get(f)}}let a=_=>_&&typeof _=="object"&&typeof _.then=="function",p=(_,f)=>(...w)=>{o.runtime.lastError?_.reject(new Error(o.runtime.lastError.message)):f.singleCallbackArg||w.length<=1&&f.singleCallbackArg!==!1?_.resolve(w[0]):_.resolve(w)},u=_=>_==1?"argument":"arguments",x=(_,f)=>function(T,...h){if(h.length<f.minArgs)throw new Error(`Expected at least ${f.minArgs} ${u(f.minArgs)} for ${_}(), got ${h.length}`);if(h.length>f.maxArgs)throw new Error(`Expected at most ${f.maxArgs} ${u(f.maxArgs)} for ${_}(), got ${h.length}`);return new Promise((V,M)=>{if(f.fallbackToNoCallback)try{T[_](...h,p({resolve:V,reject:M},f))}catch(y){console.warn(`${_} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,y),T[_](...h),f.fallbackToNoCallback=!1,f.noCallback=!0,V()}else f.noCallback?(T[_](...h),V()):T[_](...h,p({resolve:V,reject:M},f))})},k=(_,f,w)=>new Proxy(f,{apply(T,h,V){return w.call(h,_,...V)}}),L=Function.call.bind(Object.prototype.hasOwnProperty),E=(_,f={},w={})=>{let T=Object.create(null),h={has(M,y){return y in _||y in T},get(M,y,$){if(y in T)return T[y];if(!(y in _))return;let N=_[y];if(typeof N=="function")if(typeof f[y]=="function")N=k(_,_[y],f[y]);else if(L(w,y)){let ne=x(y,w[y]);N=k(_,_[y],ne)}else N=N.bind(_);else if(typeof N=="object"&&N!==null&&(L(f,y)||L(w,y)))N=E(N,f[y],w[y]);else if(L(w,"*"))N=E(N,f[y],w["*"]);else return Object.defineProperty(T,y,{configurable:!0,enumerable:!0,get(){return _[y]},set(ne){_[y]=ne}}),N;return T[y]=N,N},set(M,y,$,N){return y in T?T[y]=$:_[y]=$,!0},defineProperty(M,y,$){return Reflect.defineProperty(T,y,$)},deleteProperty(M,y){return Reflect.deleteProperty(T,y)}},V=Object.create(_);return new Proxy(V,h)},D=_=>({addListener(f,w,...T){f.addListener(_.get(w),...T)},hasListener(f,w){return f.hasListener(_.get(w))},removeListener(f,w){f.removeListener(_.get(w))}}),re=new i(_=>typeof _!="function"?_:function(w){let T=E(w,{},{getContent:{minArgs:0,maxArgs:0}});_(T)}),ge=new i(_=>typeof _!="function"?_:function(w,T,h){let V=!1,M,y=new Promise(we=>{M=function(Y){V=!0,we(Y)}}),$;try{$=_(w,T,M)}catch(we){$=Promise.reject(we)}let N=$!==!0&&a($);if($!==!0&&!N&&!V)return!1;let ne=we=>{we.then(Y=>{h(Y)},Y=>{let We;Y&&(Y instanceof Error||typeof Y.message=="string")?We=Y.message:We="An unexpected error occurred",h({__mozWebExtensionPolyfillReject__:!0,message:We})}).catch(Y=>{console.error("Failed to send onMessage rejected reply",Y)})};return ne(N?$:y),!0}),xe=({reject:_,resolve:f},w)=>{o.runtime.lastError?o.runtime.lastError.message===e?f():_(new Error(o.runtime.lastError.message)):w&&w.__mozWebExtensionPolyfillReject__?_(new Error(w.message)):f(w)},at=(_,f,w,...T)=>{if(T.length<f.minArgs)throw new Error(`Expected at least ${f.minArgs} ${u(f.minArgs)} for ${_}(), got ${T.length}`);if(T.length>f.maxArgs)throw new Error(`Expected at most ${f.maxArgs} ${u(f.maxArgs)} for ${_}(), got ${T.length}`);return new Promise((h,V)=>{let M=xe.bind(null,{resolve:h,reject:V});T.push(M),w.sendMessage(...T)})},wt={devtools:{network:{onRequestFinished:D(re)}},runtime:{onMessage:D(ge),onMessageExternal:D(ge),sendMessage:at.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:at.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},q={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":q},services:{"*":q},websites:{"*":q}},E(o,wt,r)};s.exports=t(chrome)}else s.exports=globalThis.browser})});var _r=Bo((Qt,eo)=>{(function(s,e){typeof Qt=="object"&&typeof eo<"u"?eo.exports=e():typeof define=="function"&&define.amd?define(e):(s=typeof globalThis<"u"?globalThis:s||self,s.DOMPurify=e())})(Qt,function(){"use strict";let{entries:s,setPrototypeOf:e,isFrozen:t,getPrototypeOf:o,getOwnPropertyDescriptor:r}=Object,{freeze:i,seal:a,create:p}=Object,{apply:u,construct:x}=typeof Reflect<"u"&&Reflect;i||(i=function(d){return d}),a||(a=function(d){return d}),u||(u=function(d,v,b){return d.apply(v,b)}),x||(x=function(d,v){return new d(...v)});let k=w(Array.prototype.forEach),L=w(Array.prototype.pop),E=w(Array.prototype.push),D=w(String.prototype.toLowerCase),re=w(String.prototype.toString),ge=w(String.prototype.match),xe=w(String.prototype.replace),at=w(String.prototype.indexOf),wt=w(String.prototype.trim),q=w(Object.prototype.hasOwnProperty),_=w(RegExp.prototype.test),f=T(TypeError);function w(A){return function(d){for(var v=arguments.length,b=new Array(v>1?v-1:0),j=1;j<v;j++)b[j-1]=arguments[j];return u(A,d,b)}}function T(A){return function(){for(var d=arguments.length,v=new Array(d),b=0;b<d;b++)v[b]=arguments[b];return x(A,v)}}function h(A,d){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:D;e&&e(A,null);let b=d.length;for(;b--;){let j=d[b];if(typeof j=="string"){let pe=v(j);pe!==j&&(t(d)||(d[b]=pe),j=pe)}A[j]=!0}return A}function V(A){for(let d=0;d<A.length;d++)q(A,d)||(A[d]=null);return A}function M(A){let d=p(null);for(let[v,b]of s(A))q(A,v)&&(Array.isArray(b)?d[v]=V(b):b&&typeof b=="object"&&b.constructor===Object?d[v]=M(b):d[v]=b);return d}function y(A,d){for(;A!==null;){let b=r(A,d);if(b){if(b.get)return w(b.get);if(typeof b.value=="function")return w(b.value)}A=o(A)}function v(){return null}return v}let $=i(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),N=i(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ne=i(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),we=i(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Y=i(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),We=i(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),ro=i(["#text"]),so=i(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),yt=i(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),no=i(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ct=i(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),dr=a(/\{\{[\w\W]*|[\w\W]*\}\}/gm),gr=a(/<%[\w\W]*|[\w\W]*%>/gm),hr=a(/\${[\w\W]*}/gm),fr=a(/^data-[\-\w.\u00B7-\uFFFF]/),xr=a(/^aria-[\-\w]+$/),io=a(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),wr=a(/^(?:\w+script|data):/i),yr=a(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ao=a(/^html$/i);var co=Object.freeze({__proto__:null,MUSTACHE_EXPR:dr,ERB_EXPR:gr,TMPLIT_EXPR:hr,DATA_ATTR:fr,ARIA_ATTR:xr,IS_ALLOWED_URI:io,IS_SCRIPT_OR_DATA:wr,ATTR_WHITESPACE:yr,DOCTYPE_NAME:ao});let Sr=function(){return typeof window>"u"?null:window},br=function(d,v){if(typeof d!="object"||typeof d.createPolicy!="function")return null;let b=null,j="data-tt-policy-suffix";v&&v.hasAttribute(j)&&(b=v.getAttribute(j));let pe="dompurify"+(b?"#"+b:"");try{return d.createPolicy(pe,{createHTML(ke){return ke},createScriptURL(ke){return ke}})}catch{return console.warn("TrustedTypes policy "+pe+" could not be created."),null}};function po(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Sr(),d=g=>po(g);if(d.version="3.0.9",d.removed=[],!A||!A.document||A.document.nodeType!==9)return d.isSupported=!1,d;let{document:v}=A,b=v,j=b.currentScript,{DocumentFragment:pe,HTMLTemplateElement:ke,Node:St,Element:lo,NodeFilter:bt,NamedNodeMap:vr=A.NamedNodeMap||A.MozNamedAttrMap,HTMLFormElement:Tr,DOMParser:Pr,trustedTypes:pt}=A,lt=lo.prototype,kr=y(lt,"cloneNode"),Cr=y(lt,"nextSibling"),Ir=y(lt,"childNodes"),At=y(lt,"parentNode");if(typeof ke=="function"){let g=v.createElement("template");g.content&&g.content.ownerDocument&&(v=g.content.ownerDocument)}let J,ze="",{implementation:vt,createNodeIterator:Er,createDocumentFragment:Dr,getElementsByTagName:Nr}=v,{importNode:Rr}=b,ie={};d.isSupported=typeof s=="function"&&typeof At=="function"&&vt&&vt.createHTMLDocument!==void 0;let{MUSTACHE_EXPR:Tt,ERB_EXPR:Pt,TMPLIT_EXPR:kt,DATA_ATTR:Lr,ARIA_ATTR:Mr,IS_SCRIPT_OR_DATA:Or,ATTR_WHITESPACE:_o}=co,{IS_ALLOWED_URI:uo}=co,F=null,mo=h({},[...$,...N,...ne,...Y,...ro]),U=null,go=h({},[...so,...yt,...no,...ct]),R=Object.seal(p(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),je=null,Ct=null,ho=!0,It=!0,fo=!1,xo=!0,Ce=!1,ye=!1,Et=!1,Dt=!1,Ie=!1,_t=!1,ut=!1,wo=!0,yo=!1,Fr="user-content-",Nt=!0,He=!1,Ee={},De=null,So=h({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),bo=null,Ao=h({},["audio","video","img","source","image","track"]),Rt=null,vo=h({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),mt="http://www.w3.org/1998/Math/MathML",dt="http://www.w3.org/2000/svg",le="http://www.w3.org/1999/xhtml",Ne=le,Lt=!1,Mt=null,Ur=h({},[mt,dt,le],re),Ge=null,Br=["application/xhtml+xml","text/html"],Wr="text/html",B=null,Re=null,zr=v.createElement("form"),To=function(n){return n instanceof RegExp||n instanceof Function},Ot=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Re&&Re===n)){if((!n||typeof n!="object")&&(n={}),n=M(n),Ge=Br.indexOf(n.PARSER_MEDIA_TYPE)===-1?Wr:n.PARSER_MEDIA_TYPE,B=Ge==="application/xhtml+xml"?re:D,F=q(n,"ALLOWED_TAGS")?h({},n.ALLOWED_TAGS,B):mo,U=q(n,"ALLOWED_ATTR")?h({},n.ALLOWED_ATTR,B):go,Mt=q(n,"ALLOWED_NAMESPACES")?h({},n.ALLOWED_NAMESPACES,re):Ur,Rt=q(n,"ADD_URI_SAFE_ATTR")?h(M(vo),n.ADD_URI_SAFE_ATTR,B):vo,bo=q(n,"ADD_DATA_URI_TAGS")?h(M(Ao),n.ADD_DATA_URI_TAGS,B):Ao,De=q(n,"FORBID_CONTENTS")?h({},n.FORBID_CONTENTS,B):So,je=q(n,"FORBID_TAGS")?h({},n.FORBID_TAGS,B):{},Ct=q(n,"FORBID_ATTR")?h({},n.FORBID_ATTR,B):{},Ee=q(n,"USE_PROFILES")?n.USE_PROFILES:!1,ho=n.ALLOW_ARIA_ATTR!==!1,It=n.ALLOW_DATA_ATTR!==!1,fo=n.ALLOW_UNKNOWN_PROTOCOLS||!1,xo=n.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Ce=n.SAFE_FOR_TEMPLATES||!1,ye=n.WHOLE_DOCUMENT||!1,Ie=n.RETURN_DOM||!1,_t=n.RETURN_DOM_FRAGMENT||!1,ut=n.RETURN_TRUSTED_TYPE||!1,Dt=n.FORCE_BODY||!1,wo=n.SANITIZE_DOM!==!1,yo=n.SANITIZE_NAMED_PROPS||!1,Nt=n.KEEP_CONTENT!==!1,He=n.IN_PLACE||!1,uo=n.ALLOWED_URI_REGEXP||io,Ne=n.NAMESPACE||le,R=n.CUSTOM_ELEMENT_HANDLING||{},n.CUSTOM_ELEMENT_HANDLING&&To(n.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(R.tagNameCheck=n.CUSTOM_ELEMENT_HANDLING.tagNameCheck),n.CUSTOM_ELEMENT_HANDLING&&To(n.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(R.attributeNameCheck=n.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),n.CUSTOM_ELEMENT_HANDLING&&typeof n.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(R.allowCustomizedBuiltInElements=n.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Ce&&(It=!1),_t&&(Ie=!0),Ee&&(F=h({},ro),U=[],Ee.html===!0&&(h(F,$),h(U,so)),Ee.svg===!0&&(h(F,N),h(U,yt),h(U,ct)),Ee.svgFilters===!0&&(h(F,ne),h(U,yt),h(U,ct)),Ee.mathMl===!0&&(h(F,Y),h(U,no),h(U,ct))),n.ADD_TAGS&&(F===mo&&(F=M(F)),h(F,n.ADD_TAGS,B)),n.ADD_ATTR&&(U===go&&(U=M(U)),h(U,n.ADD_ATTR,B)),n.ADD_URI_SAFE_ATTR&&h(Rt,n.ADD_URI_SAFE_ATTR,B),n.FORBID_CONTENTS&&(De===So&&(De=M(De)),h(De,n.FORBID_CONTENTS,B)),Nt&&(F["#text"]=!0),ye&&h(F,["html","head","body"]),F.table&&(h(F,["tbody"]),delete je.tbody),n.TRUSTED_TYPES_POLICY){if(typeof n.TRUSTED_TYPES_POLICY.createHTML!="function")throw f('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof n.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw f('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');J=n.TRUSTED_TYPES_POLICY,ze=J.createHTML("")}else J===void 0&&(J=br(pt,j)),J!==null&&typeof ze=="string"&&(ze=J.createHTML(""));i&&i(n),Re=n}},Po=h({},["mi","mo","mn","ms","mtext"]),ko=h({},["foreignobject","desc","title","annotation-xml"]),jr=h({},["title","style","font","a","script"]),Co=h({},[...N,...ne,...we]),Io=h({},[...Y,...We]),Hr=function(n){let l=At(n);(!l||!l.tagName)&&(l={namespaceURI:Ne,tagName:"template"});let m=D(n.tagName),C=D(l.tagName);return Mt[n.namespaceURI]?n.namespaceURI===dt?l.namespaceURI===le?m==="svg":l.namespaceURI===mt?m==="svg"&&(C==="annotation-xml"||Po[C]):!!Co[m]:n.namespaceURI===mt?l.namespaceURI===le?m==="math":l.namespaceURI===dt?m==="math"&&ko[C]:!!Io[m]:n.namespaceURI===le?l.namespaceURI===dt&&!ko[C]||l.namespaceURI===mt&&!Po[C]?!1:!Io[m]&&(jr[m]||!Co[m]):!!(Ge==="application/xhtml+xml"&&Mt[n.namespaceURI]):!1},Se=function(n){E(d.removed,{element:n});try{n.parentNode.removeChild(n)}catch{n.remove()}},Ft=function(n,l){try{E(d.removed,{attribute:l.getAttributeNode(n),from:l})}catch{E(d.removed,{attribute:null,from:l})}if(l.removeAttribute(n),n==="is"&&!U[n])if(Ie||_t)try{Se(l)}catch{}else try{l.setAttribute(n,"")}catch{}},Eo=function(n){let l=null,m=null;if(Dt)n="<remove></remove>"+n;else{let G=ge(n,/^[\r\n\t ]+/);m=G&&G[0]}Ge==="application/xhtml+xml"&&Ne===le&&(n='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+n+"</body></html>");let C=J?J.createHTML(n):n;if(Ne===le)try{l=new Pr().parseFromString(C,Ge)}catch{}if(!l||!l.documentElement){l=vt.createDocument(Ne,"template",null);try{l.documentElement.innerHTML=Lt?ze:C}catch{}}let H=l.body||l.documentElement;return n&&m&&H.insertBefore(v.createTextNode(m),H.childNodes[0]||null),Ne===le?Nr.call(l,ye?"html":"body")[0]:ye?l.documentElement:H},Do=function(n){return Er.call(n.ownerDocument||n,n,bt.SHOW_ELEMENT|bt.SHOW_COMMENT|bt.SHOW_TEXT,null)},Gr=function(n){return n instanceof Tr&&(typeof n.nodeName!="string"||typeof n.textContent!="string"||typeof n.removeChild!="function"||!(n.attributes instanceof vr)||typeof n.removeAttribute!="function"||typeof n.setAttribute!="function"||typeof n.namespaceURI!="string"||typeof n.insertBefore!="function"||typeof n.hasChildNodes!="function")},No=function(n){return typeof St=="function"&&n instanceof St},_e=function(n,l,m){ie[n]&&k(ie[n],C=>{C.call(d,l,m,Re)})},Ro=function(n){let l=null;if(_e("beforeSanitizeElements",n,null),Gr(n))return Se(n),!0;let m=B(n.nodeName);if(_e("uponSanitizeElement",n,{tagName:m,allowedTags:F}),n.hasChildNodes()&&!No(n.firstElementChild)&&_(/<[/\w]/g,n.innerHTML)&&_(/<[/\w]/g,n.textContent))return Se(n),!0;if(!F[m]||je[m]){if(!je[m]&&Mo(m)&&(R.tagNameCheck instanceof RegExp&&_(R.tagNameCheck,m)||R.tagNameCheck instanceof Function&&R.tagNameCheck(m)))return!1;if(Nt&&!De[m]){let C=At(n)||n.parentNode,H=Ir(n)||n.childNodes;if(H&&C){let G=H.length;for(let X=G-1;X>=0;--X)C.insertBefore(kr(H[X],!0),Cr(n))}}return Se(n),!0}return n instanceof lo&&!Hr(n)||(m==="noscript"||m==="noembed"||m==="noframes")&&_(/<\/no(script|embed|frames)/i,n.innerHTML)?(Se(n),!0):(Ce&&n.nodeType===3&&(l=n.textContent,k([Tt,Pt,kt],C=>{l=xe(l,C," ")}),n.textContent!==l&&(E(d.removed,{element:n.cloneNode()}),n.textContent=l)),_e("afterSanitizeElements",n,null),!1)},Lo=function(n,l,m){if(wo&&(l==="id"||l==="name")&&(m in v||m in zr))return!1;if(!(It&&!Ct[l]&&_(Lr,l))){if(!(ho&&_(Mr,l))){if(!U[l]||Ct[l]){if(!(Mo(n)&&(R.tagNameCheck instanceof RegExp&&_(R.tagNameCheck,n)||R.tagNameCheck instanceof Function&&R.tagNameCheck(n))&&(R.attributeNameCheck instanceof RegExp&&_(R.attributeNameCheck,l)||R.attributeNameCheck instanceof Function&&R.attributeNameCheck(l))||l==="is"&&R.allowCustomizedBuiltInElements&&(R.tagNameCheck instanceof RegExp&&_(R.tagNameCheck,m)||R.tagNameCheck instanceof Function&&R.tagNameCheck(m))))return!1}else if(!Rt[l]){if(!_(uo,xe(m,_o,""))){if(!((l==="src"||l==="xlink:href"||l==="href")&&n!=="script"&&at(m,"data:")===0&&bo[n])){if(!(fo&&!_(Or,xe(m,_o,"")))){if(m)return!1}}}}}}return!0},Mo=function(n){return n!=="annotation-xml"&&n.indexOf("-")>0},Oo=function(n){_e("beforeSanitizeAttributes",n,null);let{attributes:l}=n;if(!l)return;let m={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:U},C=l.length;for(;C--;){let H=l[C],{name:G,namespaceURI:X,value:be}=H,Ke=B(G),Z=G==="value"?be:wt(be);if(m.attrName=Ke,m.attrValue=Z,m.keepAttr=!0,m.forceKeepAttr=void 0,_e("uponSanitizeAttribute",n,m),Z=m.attrValue,m.forceKeepAttr||(Ft(G,n),!m.keepAttr))continue;if(!xo&&_(/\/>/i,Z)){Ft(G,n);continue}Ce&&k([Tt,Pt,kt],Uo=>{Z=xe(Z,Uo," ")});let Fo=B(n.nodeName);if(Lo(Fo,Ke,Z)){if(yo&&(Ke==="id"||Ke==="name")&&(Ft(G,n),Z=Fr+Z),J&&typeof pt=="object"&&typeof pt.getAttributeType=="function"&&!X)switch(pt.getAttributeType(Fo,Ke)){case"TrustedHTML":{Z=J.createHTML(Z);break}case"TrustedScriptURL":{Z=J.createScriptURL(Z);break}}try{X?n.setAttributeNS(X,G,Z):n.setAttribute(G,Z),L(d.removed)}catch{}}}_e("afterSanitizeAttributes",n,null)},Kr=function g(n){let l=null,m=Do(n);for(_e("beforeSanitizeShadowDOM",n,null);l=m.nextNode();)_e("uponSanitizeShadowNode",l,null),!Ro(l)&&(l.content instanceof pe&&g(l.content),Oo(l));_e("afterSanitizeShadowDOM",n,null)};return d.sanitize=function(g){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=null,m=null,C=null,H=null;if(Lt=!g,Lt&&(g="<!-->"),typeof g!="string"&&!No(g))if(typeof g.toString=="function"){if(g=g.toString(),typeof g!="string")throw f("dirty is not a string, aborting")}else throw f("toString is not a function");if(!d.isSupported)return g;if(Et||Ot(n),d.removed=[],typeof g=="string"&&(He=!1),He){if(g.nodeName){let be=B(g.nodeName);if(!F[be]||je[be])throw f("root node is forbidden and cannot be sanitized in-place")}}else if(g instanceof St)l=Eo("<!---->"),m=l.ownerDocument.importNode(g,!0),m.nodeType===1&&m.nodeName==="BODY"||m.nodeName==="HTML"?l=m:l.appendChild(m);else{if(!Ie&&!Ce&&!ye&&g.indexOf("<")===-1)return J&&ut?J.createHTML(g):g;if(l=Eo(g),!l)return Ie?null:ut?ze:""}l&&Dt&&Se(l.firstChild);let G=Do(He?g:l);for(;C=G.nextNode();)Ro(C)||(C.content instanceof pe&&Kr(C.content),Oo(C));if(He)return g;if(Ie){if(_t)for(H=Dr.call(l.ownerDocument);l.firstChild;)H.appendChild(l.firstChild);else H=l;return(U.shadowroot||U.shadowrootmode)&&(H=Rr.call(b,H,!0)),H}let X=ye?l.outerHTML:l.innerHTML;return ye&&F["!doctype"]&&l.ownerDocument&&l.ownerDocument.doctype&&l.ownerDocument.doctype.name&&_(ao,l.ownerDocument.doctype.name)&&(X="<!DOCTYPE "+l.ownerDocument.doctype.name+`>
`+X),Ce&&k([Tt,Pt,kt],be=>{X=xe(X,be," ")}),J&&ut?J.createHTML(X):X},d.setConfig=function(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ot(g),Et=!0},d.clearConfig=function(){Re=null,Et=!1},d.isValidAttribute=function(g,n,l){Re||Ot({});let m=B(g),C=B(n);return Lo(m,C,l)},d.addHook=function(g,n){typeof n=="function"&&(ie[g]=ie[g]||[],E(ie[g],n))},d.removeHook=function(g){if(ie[g])return L(ie[g])},d.removeHooks=function(g){ie[g]&&(ie[g]=[])},d.removeAllHooks=function(){ie={}},d}var Ar=po();return Ar})});var ls={};Xr(ls,{Unrecognized:()=>z});var zo="options_contextSteamStore",jo="options_contextSteamMarket",Ho="options_contextItad",Go="options_contextBartervg",Ko="options_contextSteamdb",qo="options_contextSteamdbInstant",Vo="options_contextSteamKeys";var $o="userNote_syncErrorEmpty",Jo="userNote_syncErrorUnknown",Yo="userNote_syncErrorLength";var Zo=te(oe()),Le={version:Zo.default.runtime.getManifest().version,db_version:6};var Bt=te(oe());var ds=te(oe()),Ae=class{constructor(e){this.storageArea=e}get onChanged(){return this.storageArea.onChanged}async get(e){return(await this.storageArea.get(e))[e]??void 0}getObject(e){return this.storageArea.get(e)}set(e,t){return this.storageArea.set({[e]:t})}setObject(e){return this.storageArea.set(e)}remove(...e){return this.storageArea.remove(e)}};var ve=class extends Ae{constructor(){super(Bt.default.storage.sync)}get QUOTA_BYTES_PER_ITEM(){return Bt.default.storage.sync.QUOTA_BYTES_PER_ITEM}},fs=new ve;var ht={language:"english",version:Le.version,version_show:!0,highlight_owned_color:"#00ce67",highlight_wishlist_color:"#0491bf",highlight_coupon_color:"#a26426",highlight_inv_gift_color:"#800040",highlight_inv_guestpass_color:"#513c73",highlight_notinterested_color:"#4f4f4f",highlight_ignored_owned_color:"#4f4f4f",highlight_collection_color:"#856d0e",highlight_waitlist_color:"#4c7521",tag_owned_color:"#00b75b",tag_wishlist_color:"#0383b4",tag_coupon_color:"#c27120",tag_inv_gift_color:"#b10059",tag_inv_guestpass_color:"#65449a",tag_notinterested_color:"#4f4f4f",tag_ignored_owned_color:"#4f4f4f",tag_collection_color:"#856d0e",tag_waitlist_color:"#4c7521",highlight_owned:!0,highlight_wishlist:!0,highlight_coupon:!1,highlight_inv_gift:!1,highlight_inv_guestpass:!1,highlight_notinterested:!1,highlight_ignored_owned:!1,highlight_excludef2p:!1,highlight_collection:!0,highlight_waitlist:!0,tag_owned:!1,tag_wishlist:!1,tag_coupon:!1,tag_inv_gift:!1,tag_inv_guestpass:!1,tag_notinterested:!0,tag_ignored_owned:!0,tag_collection:!1,tag_waitlist:!1,tag_short:!1,hidetmsymbols:!1,showlowestprice:!0,showlowestprice_onwishlist:!0,showlowestpricecoupon:!0,showallstores:!0,excluded_stores:[],override_price:"auto",showregionalprice:"mouse",regional_countries:["us","gb","fr","br","au","jp"],show_es_homepagetabs:!0,showmarkettotal:!1,showsteamrepapi:!0,showmcus:!0,showoc:!0,showhltb:!0,showyoutube:!0,showtwitch:!0,showpcgw:!0,showcompletionistme:!1,showprotondb:!1,showviewinlibrary:!1,showsteamcardexchange:!1,showitadlinks:!0,showsteamdb:!0,showbartervg:!1,showastatslink:!0,showyoutubegameplay:!0,showyoutubereviews:!0,showwsgf:!0,exfgls:!0,app_custom_link:[{enabled:!0,name:"Google",url:"https://www.google.com/search?q=[ID]+[NAME]",icon:"https://www.google.com/images/branding/product/ico/googleg_lodp.ico"}],customize_apppage:{},customize_frontpage:{},show_package_info:!1,show_players_info:!0,show_early_access:!0,show_alternative_linux_icon:!1,show_itad_button:!1,skip_got_steam:!1,installsteam:"show",openinnewtab:!1,keepssachecked:!1,showemptywishlist:!0,user_notes_app:!0,user_notes_wishlist:!0,showwishliststats:!0,oneclickremovewl:!1,user_notes_adapter:"idb",showlanguagewarning:!0,showlanguagewarninglanguage:"english",homepage_tab_selection:"remember",send_age_info:!0,showdeckcompat:!1,removebroadcasts:!1,mp4video:!1,horizontalscrolling:!0,showsupportinfo:!0,showdrm:!0,regional_hideworld:!1,showinvnav:!0,quickinv:!0,quickinv_diff:-.01,community_default_tab:"",showallstats:!0,replacecommunityhublinks:!1,hideannouncementcomments:!1,showachinstore:!0,hideactivelistings:!1,showlowestmarketprice:!0,hidespamcomments:!1,spamcommentregex:"[\\u2500-\\u25FF]",wlbuttoncommunityapp:!0,removeguideslanguagefilter:!1,confirmdeletecomment:!0,disablelinkfilter:!1,show1clickgoo:!0,show_profile_link_images:"gray",show_custom_themes:!0,profile_pinned_bg:!1,friends_append_nickname:!1,profile_steamrepcn:!0,profile_steamgifts:!0,profile_steamtrades:!0,profile_bartervg:!0,profile_steamrep:!0,profile_steamdbcalc:!0,profile_astats:!0,profile_backpacktf:!0,profile_astatsnl:!0,profile_steamid:!0,profile_custom_link:[{enabled:!0,name:"Google",url:"https://www.google.com/search?q=[ID]",icon:"https://www.google.com/images/branding/product/ico/googleg_lodp.ico"}],group_steamgifts:!0,steamcardexchange:!0,purchase_dates:!0,show_badge_progress:!0,show_coupon:!0,show_wishlist_link:!0,show_wishlist_count:!0,show_progressbar:!0,show_backtotop:!1,profile_showcase_twitch:!0,profile_showcase_own_twitch:!1,profile_showcase_twitch_profileonly:!1,itad_sync_library:!0,itad_sync_wishlist:!0,add_to_waitlist:!1,collection_banner_notowned:!1,itad_sync_notes:!1,context_steam_store:!1,context_steam_market:!1,context_itad:!1,context_bartervg:!1,context_steamdb:!1,context_steamdb_instant:!1,context_steam_keys:!1},ft=class{constructor(){this.listeners=new Set}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}invoke(){for(let e of this.listeners)e()}},K=class{static{this.storage=new ve}static{this.onSaveStart=new ft}static{this.onSaveEnd=new ft}static async load(){this.data=await this.storage.getObject(ht)}static init(){return this.promise||(this.promise=this.load()),this.promise}static getDefault(e){return ht[e]}static get(e){if(!this.data)throw new Error("Settings have not been loaded");return this.data[e]}static async set(e,t){this.onSaveStart.invoke(),this.data[e]=t,await this.storage.set(e,t),this.onSaveEnd.invoke()}static remove(e){this.storage.remove(e),this.data[e]=structuredClone(ht[e])}static clear(){this.storage.remove(...Object.keys(this.data)),this.data=structuredClone(ht)}static async import(e){await this.storage.setObject(e),await this.load()}static asObject(){return structuredClone(this.data)}},I=new Proxy(K,{get(s,e){return s.get(e)},set(s,e,t){return s.set(e,t),!0}});var Qo=te(oe()),qe=class s{static getURL(e){return Qo.default.runtime.getURL(e)}static get(e){return fetch(s.getURL(e))}static async getJSON(e){return await(await s.get(e)).json()}static async getText(e){return await(await s.get(e)).text()}};var Ve=class{static{this.loaded=!1}static loadConfig(){if(this.loaded)return;let e=document.querySelector("#application_config");if(!e)throw new Error("Could not find config node");if(!e.dataset.config)throw new Error("Could not find config");if(this.config=JSON.parse(e.dataset.config),!e.dataset.userinfo)throw new Error("Could not find userinfo");if(this.userInfo=JSON.parse(e.dataset.userinfo),!e.dataset.store_user_config)throw new Error("Could not find store_user_config");this.storeUserConfig=JSON.parse(e.dataset.store_user_config)}static language(){return this.loadConfig(),this.config.LANGUAGE}static countryCode(){return this.loadConfig(),this.userInfo.country_code}static webApiToken(){return this.loadConfig(),this.storeUserConfig.webapi_token}};var ue=class{static{this.currentContext=0}static set CurrentContext(e){this.currentContext=e}static isBackgroundScript(){return this.currentContext===1}static isContentScript(){return this.currentContext===2}static isOptions(){return this.currentContext===3}};var $e=class{static load(){if(this.cache=new Map,!ue.isBackgroundScript()&&typeof document<"u")for(let[e,t]of document.cookie.split(";").map(o=>o.split("=",2)))e=e.trim(),this.cache.set(e,decodeURIComponent(t))}static get(e,t=null){return this.cache===null&&this.load(),this.cache.get(e.trim())??t}};var Me=class{static{this._currentSteamLanguage=null}static{this.map={english:"en",bulgarian:"bg",czech:"cs",danish:"da",dutch:"nl",finnish:"fi",french:"fr",greek:"el",german:"de",hungarian:"hu",italian:"it",japanese:"ja",koreana:"ko",norwegian:"no",polish:"pl",portuguese:"pt-PT",brazilian:"pt-BR",russian:"ru",romanian:"ro",schinese:"zh-CN",spanish:"es-ES",latam:"es-419",swedish:"sv-SE",tchinese:"zh-TW",thai:"th",turkish:"tr",ukrainian:"ua",vietnamese:"vi"}}static getCurrentSteamLanguage(){if(!ue.isContentScript())return null;if(this._currentSteamLanguage!==null)return this._currentSteamLanguage;try{return this._currentSteamLanguage=Ve.language(),this._currentSteamLanguage}catch{}for(let e of document.querySelectorAll("script[src]")){let t=new URL(e.src).searchParams.get("l");if(t)return this._currentSteamLanguage=t,this._currentSteamLanguage}return this._currentSteamLanguage=$e.get("Steam_Language",null),this._currentSteamLanguage}static getLanguageCode(e){return this.map[e]??"en"}static isCurrentLanguageOneOf(...e){return e.includes(this.getCurrentSteamLanguage()??"")}};var er=te(oe());var Je=class{static parse(e){let t=e.match(/(.*):\s(.+)/);return t?{name:t[1]??"",message:t[2]??""}:{name:null,message:null}}};var Q=class{static async send(e,t={}){document.dispatchEvent(new CustomEvent("asRequestStart"));try{let o=await er.default.runtime.sendMessage({action:e,params:t});return document.dispatchEvent(new CustomEvent("asRequestDone")),o}catch(o){let r=Je.parse(o.message??"");throw document.dispatchEvent(new CustomEvent("asRequestError",{detail:r})),o}}};var Ye=class{static wishlistAdd(e){return Q.send("wishlist.add",{appid:e})}static wishlistRemove(e){return Q.send("wishlist.remove",{appid:e})}static fetchWishlistCount(e){return Q.send("wishlists",{path:e})}static fetchAppDetails(e,t=void 0){return Q.send("appdetails",{appid:e,filter:t})}static getPurchaseDate(e,t){return Q.send("purchases",{appName:e,lang:t})}static getCurrency(){return Q.send("currency")}static clearPurchases(){return Q.send("clearpurchases")}static clearDynamicStore(){return Q.send("dynamicstore.clear")}static getDynamicStoreStatus(e){return Q.send("dynamicstore.status",{ids:e})}static getDynamicStoreRandomApp(){return Q.send("dynamicstore.randomapp")}};var Oe=class{static load(e){return qe.getJSON(`/localization/compiled/${e}.json`)}static init(){return this.promise||(this.promise=(async()=>{let e=I.language,t=Me.getCurrentSteamLanguage();t===null?t=e:t!==e&&(I.language=t,Ye.clearPurchases());let o=Me.getLanguageCode(t);try{this.locale=await this.load(o)}catch{console.error(`Failed to load ${o}`),this.locale=await this.load("en")}})()),this.promise}};function tr(s,e=null){let t=Oe.locale.strings[s]??"<<missing text>>";if(e!==null)for(let[o,r]of Object.entries(e))t=t.replaceAll(`__${o}__`,String(r));return t}var ae=te(oe());var Te=te(oe()),Fe=class s{static contains(e){return Te.default.permissions.contains({permissions:e})}static request(e){return Te.default.permissions.request({permissions:e})}static async remove(e){return e.includes("contextMenus")&&await Te.default.contextMenus.removeAll(),Te.default.permissions.remove({permissions:e})}static async when(e,t,o){t&&(await s.contains([e])&&t(),Te.default.permissions.onAdded.addListener(r=>{r.permissions?.includes(e)&&t()})),o&&Te.default.permissions.onRemoved.addListener(r=>{r.permissions?.includes(e)&&o()})}};var Xe=class s{static{this.queryLinks={context_steam_store:[zo,"https://store.steampowered.com/search/?term=__query__",()=>I.context_steam_store],context_steam_market:[jo,"https://steamcommunity.com/market/search?q=__query__",()=>I.context_steam_market],context_itad:[Ho,"https://isthereanydeal.com/search/?q=__query__",()=>I.context_itad],context_bartervg:[Go,"https://barter.vg/search?q=__query__",()=>I.context_bartervg],context_steamdb:[Ko,"https://steamdb.info/search/?q=__query__",()=>I.context_steamdb],context_steamdb_instant:[qo,"https://steamdb.info/instantsearch/?query=__query__",()=>I.context_steamdb_instant],context_steam_keys:[Vo,"https://store.steampowered.com/account/registerkey?key=__query__",()=>I.context_steam_keys]}}static register(){return ae.default.runtime.onStartup.addListener(s.update),ae.default.runtime.onInstalled.addListener(s.update),Fe.when("contextMenus",()=>{ae.default.contextMenus.onClicked.addListener(s.onClick)},async()=>{ae.default.contextMenus.onClicked.removeListener(s.onClick),await ae.default.contextMenus.removeAll()})}static onClick(e){let t=s.queryLinks[e.menuItemId][1];if(!t)return;let o=e.selectionText.trim();if(e.menuItemId==="context_steam_keys"){let r=o.match(/[A-Z0-9]{5}(-[A-Z0-9]{5}){2}/g);Array.isArray(r)&&(o=r.join(","))}ae.default.tabs.create({url:t.replace("__query__",encodeURIComponent(o))})}static async build(){await K.init(),await Oe.init();for(let[e,t]of Object.entries(s.queryLinks)){let[o,r,i]=t;i()&&ae.default.contextMenus.create({id:e,title:tr(o,{query:"%s"}),contexts:["selection"]},()=>ae.default.runtime.lastError)}}static async update(){if(await K.init(),!await Fe.contains(["contextMenus"])){I.context_steam_store=!1,I.context_steam_market=!1,I.context_itad=!1,I.context_bartervg=!1,I.context_steamdb=!1,I.context_steamdb_instant=!1,I.context_steam_keys=!1;return}return await ae.default.contextMenus.removeAll(),s.build()}};var Qr=(s,e)=>e.some(t=>s instanceof t),or,rr;function es(){return or||(or=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ts(){return rr||(rr=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var sr=new WeakMap,zt=new WeakMap,nr=new WeakMap,Wt=new WeakMap,Ht=new WeakMap;function os(s){let e=new Promise((t,o)=>{let r=()=>{s.removeEventListener("success",i),s.removeEventListener("error",a)},i=()=>{t(ce(s.result)),r()},a=()=>{o(s.error),r()};s.addEventListener("success",i),s.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&sr.set(t,s)}).catch(()=>{}),Ht.set(e,s),e}function rs(s){if(zt.has(s))return;let e=new Promise((t,o)=>{let r=()=>{s.removeEventListener("complete",i),s.removeEventListener("error",a),s.removeEventListener("abort",a)},i=()=>{t(),r()},a=()=>{o(s.error||new DOMException("AbortError","AbortError")),r()};s.addEventListener("complete",i),s.addEventListener("error",a),s.addEventListener("abort",a)});zt.set(s,e)}var jt={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return zt.get(s);if(e==="objectStoreNames")return s.objectStoreNames||nr.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ce(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function ir(s){jt=s(jt)}function ss(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let o=s.call(xt(this),e,...t);return nr.set(o,e.sort?e.sort():[e]),ce(o)}:ts().includes(s)?function(...e){return s.apply(xt(this),e),ce(sr.get(this))}:function(...e){return ce(s.apply(xt(this),e))}}function ns(s){return typeof s=="function"?ss(s):(s instanceof IDBTransaction&&rs(s),Qr(s,es())?new Proxy(s,jt):s)}function ce(s){if(s instanceof IDBRequest)return os(s);if(Wt.has(s))return Wt.get(s);let e=ns(s);return e!==s&&(Wt.set(s,e),Ht.set(e,s)),e}var xt=s=>Ht.get(s);function cr(s,e,{blocked:t,upgrade:o,blocking:r,terminated:i}={}){let a=indexedDB.open(s,e),p=ce(a);return o&&a.addEventListener("upgradeneeded",u=>{o(ce(a.result),u.oldVersion,u.newVersion,ce(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),p.then(u=>{i&&u.addEventListener("close",()=>i()),r&&u.addEventListener("versionchange",x=>r(x.oldVersion,x.newVersion,x))}).catch(()=>{}),p}var is=["get","getKey","getAll","getAllKeys","count"],as=["put","add","delete","clear"],Gt=new Map;function ar(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(Gt.get(e))return Gt.get(e);let t=e.replace(/FromIndex$/,""),o=e!==t,r=as.includes(t);if(!(t in(o?IDBIndex:IDBObjectStore).prototype)||!(r||is.includes(t)))return;let i=async function(a,...p){let u=this.transaction(a,r?"readwrite":"readonly"),x=u.store;return o&&(x=x.index(p.shift())),(await Promise.all([x[t](...p),r&&u.done]))[0]};return Gt.set(e,i),i}ir(s=>({...s,get:(e,t,o)=>ar(e,t)||s.get(e,t,o),has:(e,t)=>!!ar(e,t)||s.has(e,t)}));async function cs(s,e,t,o){if(e==0&&(s.createObjectStore("items"),s.createObjectStore("earlyAccessAppids"),s.createObjectStore("collection"),s.createObjectStore("waitlist"),s.createObjectStore("itadImport"),s.createObjectStore("purchases"),s.createObjectStore("notes")),e<5&&(e>=1&&(s.deleteObjectStore("storePageData"),s.deleteObjectStore("profiles"),s.deleteObjectStore("rates"),s.deleteObjectStore("coupons"),s.deleteObjectStore("giftsAndPasses"),s.deleteObjectStore("dynamicStore"),s.deleteObjectStore("packages")),e>=2&&(s.deleteObjectStore("workshopFileSizes"),s.deleteObjectStore("reviews")),e>=3&&s.deleteObjectStore("expiries"),e>=4&&s.deleteObjectStore("storeList"),s.createObjectStore("storePageData").createIndex("idx_expiry","expiry"),s.createObjectStore("profiles").createIndex("idx_expiry","expiry"),s.createObjectStore("rates").createIndex("idx_expiry","expiry"),s.createObjectStore("coupons").createIndex("idx_appid","appids",{unique:!1,multiEntry:!0}),s.createObjectStore("giftsAndPasses").createIndex("idx_appid","",{unique:!1,multiEntry:!0}),s.createObjectStore("dynamicStore").createIndex("idx_appid","",{unique:!1,multiEntry:!0}),s.createObjectStore("packages").createIndex("idx_expiry","expiry"),s.createObjectStore("workshopFileSizes").createIndex("idx_expiry","expiry"),s.createObjectStore("reviews").createIndex("idx_expiry","expiry"),s.createObjectStore("expiries").createIndex("idx_expiry",""),s.createObjectStore("storeList")),e<6){let r=await o.objectStore("collection").getAllKeys(),i=o.objectStore("collection");for(let a of r)i.put([],a)}console.log(`DB migrated, ${e} -> ${t}`)}var pr={upgrade:cs};var lr=te(oe());var Kt=class extends Ae{constructor(){super(lr.default.storage.local)}},P=new Kt;var qt=class{constructor(e){this.promise=new Promise(t=>setTimeout(t,e))}then(e){return this.promise.then(e)}},Vt=class{constructor(e,t){this._running=!1;this.onDone=e,this.duration=t,this.reset()}get running(){return this._running}reset(){typeof this.id<"u"&&clearTimeout(this.id),this.id=setTimeout(async()=>{await this.onDone(),this._running=!1},this.duration),this._running=!0}stop(){typeof this.id<"u"&&(clearTimeout(this.id),this.id=void 0),this._running=!1}},S=class{static timer(e){return new qt(e)}static resettableTimer(e,t){return new Vt(e,t)}static now(){return Math.trunc(Date.now()/1e3)}static isInPast(e){return e<=this.now()}static isInFuture(e){return e>this.now()}};var c=class s{static init(){return this.promise||(this.promise=(async()=>{this.db=await cr("Augmented Steam",Le.db_version,{upgrade:pr.upgrade,blocked(){console.error("Failed to upgrade database, there is already an open connection")}});let e=await P.get("db_cleanup");(!e||S.isInPast(e+86400))&&(console.log("Db cleanup"),await s.cleanup(),await P.set("db_cleanup",S.now()))})()),this.promise}static async cleanup(){let e=[],t=this.db.transaction(this.db.objectStoreNames,"readwrite"),o=await t.objectStore("expiries").index("idx_expiry").openCursor(IDBKeyRange.upperBound(S.now()));for(;o;){let r=o.key;this.db.objectStoreNames.contains(r)&&e.push(t.objectStore(r).clear()),e.push(o.delete()),o=await o.continue()}await Promise.all(e),await Promise.all([this.deleteExpiredEntries("packages","idx_expiry"),this.deleteExpiredEntries("storePageData","idx_expiry"),this.deleteExpiredEntries("profiles","idx_expiry"),this.deleteExpiredEntries("rates","idx_expiry"),this.deleteExpiredEntries("workshopFileSizes","idx_expiry"),this.deleteExpiredEntries("reviews","idx_expiry")])}static async deleteExpiredEntries(e,t){let i=await this.db.transaction(e,"readwrite").store.index(t).openCursor(IDBKeyRange.upperBound(S.now()));if(i)for(;i;)await i.delete(),i=await i.continue()}static async isStoreExpired(e){let t=await this.db.get("expiries",e);return!t||S.isInPast(t)}static async setStoreExpiry(e,t){return this.db.put("expiries",S.now()+t,e)}static async put(e,t,o){await this.db.put(e,t,o)}static async putMany(e,t){let o=this.db.transaction(e,"readwrite"),r=o.store;await Promise.all(t.map(([i,a])=>r.put(a,i))),await o.done}static async replaceAll(e,t){let o=this.db.transaction(e,"readwrite"),r=o.store;await r.clear(),t.length>0&&await Promise.all(t.map(([i,a])=>r.put(a,i))),await o.done}static async get(e,t){return await this.db.get(e,t)}static async getObject(e,t){let o=await this.db.transaction(e).store.openCursor(),r=Object.fromEntries(t.map(i=>[i,void 0]));for(;o;)r[o.key]=o.value,o=await o.continue();return r}static async getFromIndex(e,t,o){return await this.db.transaction(e).store.index(t).get(o)}static async delete(e,...t){for(let o of t)await this.db.delete(e,o)}static async clear(...e){let t=this.db.transaction([...e,"expiries"],"readwrite");for(let o of e)t.objectStore("expiries").delete(o),t.objectStore(o).clear()}static async contains(e,t){let r=this.db.transaction(e).store;return Object.fromEntries(await Promise.all(t.map(async i=>[i,await r.getKey(i)!==void 0])))}};var $t=class extends Error{constructor(e){super(e),this.name="LoginError"}},Jt=class extends Error{constructor(e){super(e),this.name="ServerOutageError"}},Yt=class extends Error{constructor(e){super(e),this.name="OAuth Unauthorized"}},Xt=class extends Error{constructor(e,t){super(t),this.code=e}},Zt=class extends Error{constructor(e,t){super(e),this.featureName=t}},O={LoginError:$t,ServerOutageError:Jt,HTTPError:Xt,FeatureDependencyError:Zt,OAuthUnauthorized:Yt};var ee=class{constructor(e){this.origin=e}getUrl(e,t={}){let o=new URL(e,this.origin);for(let[r,i]of Object.entries(t))i!==void 0&&o.searchParams.set(r,String(i));return o}async fetchJson(e,t={}){let o=await fetch(e,t);if(!o.ok)throw new O.HTTPError(o.status,o.statusText);return await o.json()}async fetchText(e,t={}){let o=await fetch(e,t);if(!o.ok)throw new O.HTTPError(o.status,o.statusText);return await o.text()}};var Pn=te(_r());var fe=class{static getVariable(e,t){if(typeof e=="string"){let o=e.match(t);return o&&o[1]?o[1]:null}for(let o of e.querySelectorAll("script"))if(o.textContent){let r=o.textContent.match(t);if(r)return r&&r[1]?r[1]:null}return null}static getStringVariable(e,t=document){let o=typeof e=="string"?new RegExp(`${e}\\s*=\\s*['"](.+?)['"];`):e;return this.getVariable(t,o)}static getIntVariable(e,t=document){let o=typeof e=="string"?new RegExp(`${e}\\s*=\\s*(.+?);`):e,r=this.getVariable(t,o);return r?Number(r):null}static getArrayVariable(e,t=document){let o=typeof e=="string"?new RegExp(`${e}\\s*=\\s*(\\[.+?]);`):e,r=this.getVariable(t,o);return r?JSON.parse(r):null}static getObjectVariable(e,t=document){let o=typeof e=="string"?new RegExp(`${e}\\s*=\\s*(\\{.+?});`):e,r=this.getVariable(t,o);return r?JSON.parse(r):null}};var to=te(oe()),ur="html/offscreen_domparser.html",Ze=class{async ensureDocument(){let e=await clients.matchAll();for(let t of e)if(t.url.endsWith(ur))return;return chrome.offscreen.createDocument({url:to.default.runtime.getURL(ur),reasons:["DOM_PARSER"],justification:"Parsing data from DOM"})}closeDocument(){chrome.offscreen.closeDocument()}async send(e,t){await this.ensureDocument();let o=await to.default.runtime.sendMessage({domparser:{op:e,html:t}});return this.closeDocument(),o}parseCurrencyFromWallet(e){return this.send("currencyFromWallet",e)}parseCurrencyFromApp(e){return this.send("currencyFromApp",e)}parseWorkshopFileSize(e){return this.send("workshopFileSize",e)}parseReviews(e){return this.send("reviews",e)}parsePurchaseDates(e){return this.send("purchaseDates",e)}};var me=class{static{this.parser=null}static getParser(){return this.parser||(this.parser=new Ze),this.parser}};var Qe=class extends ee{constructor(){super("https://steamcommunity.com/")}async fetchPage(e){let t=await fetch(e,{credentials:"include"});if(!t.ok)throw new O.HTTPError(t.status,t.statusText);if(new URL(t.url).pathname==="/login/home/")throw new O.LoginError("community");return await t.text()}fetchBadgeInfo(e,t){let o=this.getUrl(`/profiles/${e}/ajaxgetbadgeinfo/${t}`);return this.fetchJson(o,{credentials:"include"})}async fetchWorkshopFileSize(e){let t=this.getUrl("/sharedfiles/filedetails/",{id:e}),o=await this.fetchText(t,{credentials:"include"}),i=await me.getParser().parseWorkshopFileSize(o);if(i===-1)throw new Error(`Couldn't find details block for item id "${e}"`);if(i===-2)throw new Error(`Invalid file size for item id "${e}"`);return i}async getWorkshopFileSize(e,t){let o=await c.get("workshopFileSizes",e);if(!o||S.isInPast(o.expiry)){if(t)return await c.delete("workshopFileSizes",e),null;o={size:await this.fetchWorkshopFileSize(e),expiry:S.now()+5*86400},await c.put("workshopFileSizes",o,e)}return o.size}async fetchReviews(e,t){let o=me.getParser(),r=[],i=0;for(let a=1;a<=t;a++){let p=this.getUrl(`${e}/recommended`,{p:a}),u=await this.fetchPage(p),x=await o.parseReviews(u);for(let k of x)k.default=i++,r.push(k)}return r}async getReviews(e,t){let o=await c.get("reviews",e);return(!o||S.isInPast(o.expiry))&&(o={data:await this.fetchReviews(e,t),expiry:S.now()+60*60},await c.put("reviews",o,e)),o.data}async login(e){if(!e)throw await this.logout(),new Error("Login endpoint needs a valid profile path");if(!e.startsWith("/id/")&&!e.startsWith("/profiles/"))throw await this.logout(),new Error(`Could not interpret ${e} as a valid profile path`);let t=await P.get("login");if(t?.profilePath===e)return t;let o=this.getUrl(e),r=await this.fetchText(o),a=fe.getObjectVariable("g_rgProfileData",r)?.steamid;if(!a)throw new Error("Failed to retrieve steamID from profile");await this.logout(!0);let p={steamId:a,profilePath:e};return await P.set("login",p),p}async logout(e=void 0){e===void 0&&(e=await P.get("login")!==void 0),e&&await Promise.all([P.remove("login"),P.remove("storeCountry"),P.remove("currency")])}async setStoreCountry(e){await P.set("storeCountry",e)}async getStoreCountry(){return await P.get("storeCountry")??null}handle(e){switch(e.action){case"community.badgeinfo":return this.fetchBadgeInfo(e.params.steamId,e.params.appid);case"community.workshopFileSize":return this.getWorkshopFileSize(e.params.id,e.params.preventFetch);case"community.reviews":return this.getReviews(e.params.steamId,e.params.pages);case"community.login":return this.login(e.params.profilePath);case"community.logout":return this.logout(e.params.force??void 0);case"community.storecountry.set":return this.setStoreCountry(e.params.newCountry);case"community.storecountry.get":return this.getStoreCountry()}return z}};var Pe=class extends ee{constructor(){super("https://store.steampowered.com/")}async fetchPage(e){let t=await fetch(e,{credentials:"include"});if(!t.ok)throw new O.HTTPError(t.status,t.statusText);if(new URL(t.url).pathname==="/login/")throw new O.LoginError("store");return await t.text()}async fetchPackageApps(e){let t=this.getUrl("/api/packagedetails/",{packageids:e}),r=(await this.fetchJson(t))[String(e)];return r&&r.success?r.data.apps.map(i=>i.id):[]}async getPackageApps(e){let t=new Map,o=[],r=await c.getObject("packages",e);for(let[i,a]of Object.entries(r))!a||S.isInPast(a.expiry)?o.push(Number(i)):t.set(Number(i),a.appids);if(o.length>0){let i=[];for(let a of o){let p=await this.fetchPackageApps(a);i.push([a,{appids:p,expiry:S.now()+86400}]),t.set(a,p)}i.length>0&&await c.putMany("packages",i)}return t}async wishlistAdd(e){let t,o=await this.fetchSessionId();if(o){let r=this.getUrl("/api/addtowishlist");t=await this.fetchJson(r,{method:"POST",credentials:"include",body:new URLSearchParams({sessionid:o,appid:String(e)})})}if(!t||!t.success)throw new Error(`Failed to add app ${e} to wishlist`);await this.clearDynamicStore()}async wishlistRemove(e){let t,o=await this.fetchSessionId();if(o){let r=this.getUrl("/api/removefromwishlist");t=await this.fetchJson(r,{method:"POST",credentials:"include",body:new URLSearchParams({sessionid:o,appid:String(e)})})}if(!t||!t.success)throw new Error(`Failed to remove app ${e} from wishlist`);await this.clearDynamicStore()}async getCurrencyFromWallet(e){let t=this.getUrl("/steamaccount/addfunds"),o=await this.fetchPage(t);return e.parseCurrencyFromWallet(o)}async getCurrencyFromApp(e){let t=this.getUrl("/app/220"),o=await this.fetchPage(t);return e.parseCurrencyFromApp(o)}async getCurrency(){let e=await P.get("currency");if(e&&S.isInFuture(e.expiry))return e.data;let t=me.getParser(),o=await this.getCurrencyFromWallet(t);if(!o&&(o=await this.getCurrencyFromApp(t),!o))throw new Error("Store currency could not be determined from app 220");return await P.set("currency",{data:o,expiry:S.now()+86400}),o}async fetchSessionId(){let e=this.getUrl("/about/"),t=await this.fetchPage(e);return fe.getStringVariable("g_sessionID",t)}async fetchWishlistCount(e){let t=this.getUrl(`/wishlist${e}`),o=await this.fetchPage(t);return fe.getArrayVariable("g_rgWishlistData",o)?.length??null}async fetchPurchaseDates(e){let t=this.getUrl("/account/licenses/",{l:e}),o=await this.fetchPage(t);return me.getParser().parsePurchaseDates(o)}async getPurchaseDate(e,t){if(await c.isStoreExpired("purchases")){let o=await this.fetchPurchaseDates(t);await c.putMany("purchases",o),await c.setStoreExpiry("purchases",86400)}return await c.get("purchases",e)??null}clearPurchases(){return c.clear("purchases")}async refreshDynamicStore(){if(!await c.isStoreExpired("dynamicStore"))return;let t=this.getUrl("dynamicstore/userdata"),o=await this.fetchJson(t,{cache:"no-cache"}),{rgOwnedApps:r,rgOwnedPackages:i,rgIgnoredApps:a,rgWishlist:p}=o,u=[],x=[];for(let[k,L]of Object.entries(a)){let E=Number(k);L===0?u.push(E):L===2&&x.push(E)}await c.putMany("dynamicStore",[["ignored",u],["ignoredOwnedElsewhere",x],["ownedApps",r],["ownedPackages",i],["wishlisted",p]]),await c.setStoreExpiry("dynamicStore",15*60)}async getDynamicStoreStatus(e){await this.refreshDynamicStore();let r=c.db.transaction("dynamicStore").store.index("idx_appid"),i=[],a=[],p=[],u=[];for(let x of e){let k=x.split("/",2);if(k.length!=2)continue;let L=k[0],E=Number(k[1]),D=await r.getAllKeys(E);for(let re of D)switch(re){case"ignored":i.push(x);break;case"ignoredOwnedElsewhere":a.push(x);break;case"wishlisted":u.push(x);break;case"ownedApps":L==="app"&&p.push(x);break;case"ownedPackages":L==="sub"&&p.push(x);break}}return{ignored:i,ignoredOwned:a,owned:p,wishlisted:u}}async dynamicStoreRandomApp(){await this.refreshDynamicStore();let e=await c.get("dynamicStore","ownedApps");return!e||!Array.isArray(e)||e.length===0?null:e[Math.floor(Math.random()*e.length)]}async clearDynamicStore(){await c.clear("dynamicStore")}async fetchAppDetails(e,t=void 0){let o=this.getUrl("api/appdetails/",{appids:e,filter:t}),r=await this.fetchJson(o,{credentials:"include"}),i=String(e);if(r&&r[i]){let a=r[i];if(a.success)return a.data}return null}handle(e){switch(e.action){case"wishlist.add":return this.wishlistAdd(e.params.appid);case"wishlist.remove":return this.wishlistRemove(e.params.appid);case"wishlists":return this.fetchWishlistCount(e.params.path);case"appdetails":return this.fetchAppDetails(e.params.appid,e.params.filter??void 0);case"currency":return this.getCurrency();case"sessionid":return this.fetchSessionId();case"purchases":return this.getPurchaseDate(e.params.appName,e.params.lang);case"clearpurchases":return this.clearPurchases();case"dynamicstore.clear":return this.clearDynamicStore();case"dynamicstore.status":return this.getDynamicStoreStatus(e.params.ids);case"dynamicstore.randomapp":return this.dynamicStoreRandomApp()}return z}};var se={ApiServerHost:"https://api.augmentedsteam.com",PublicHost:"https://augmentedsteam.com",ITADApiServerHost:"https://api.isthereanydeal.com",ITADServer:"https://isthereanydeal.com",ITADClientId:"5fe78af07889f43a",ITADDiscord:"https://discord.gg/yn57q7f"};var de=te(oe());var W=class{static{this.loadPromise=void 0}static load(){return this.loadPromise||(this.loadPromise=(async()=>{let e=await P.get("access_token");return e?S.isInPast(e.expiry)?(await P.remove("access_token"),null):e.token:null})()),this.loadPromise}static async create(e,t){await P.set("access_token",{token:e,expiry:S.now()+t}),this.loadPromise=void 0}static async clear(){await P.remove("access_token"),this.loadPromise=void 0}};var et=class{constructor(){this.RedirectURI="https://isthereanydeal.com/connectaugmentedsteam"}generateString(e){let t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789.~",o=new Uint8Array(e);return crypto.getRandomValues(o),o.reduce((r,i)=>r+t.charAt(Math.floor(i%t.length)),"")}async sha256(e){let o=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",o);return String.fromCharCode(...new Uint8Array(r))}base64url(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async getResponseUrl(e){return new Promise((t,o)=>{let r=(a,p,u)=>{a===e&&p.url?.startsWith(this.RedirectURI)&&(de.default.tabs.onUpdated.removeListener(r),de.default.tabs.onRemoved.removeListener(i),de.default.tabs.remove(a),t(new URL(p.url)))},i=(a,p)=>{a===e&&(de.default.tabs.onUpdated.removeListener(r),de.default.tabs.onRemoved.removeListener(i),o())};de.default.tabs.onUpdated.addListener(r),de.default.tabs.onRemoved.addListener(i)})}async authorize(e){let t=this.generateString(64),o=this.generateString(30),r=new URL(`${se.ITADServer}/oauth/authorize/`);r.searchParams.set("response_type","code"),r.searchParams.set("client_id",se.ITADClientId),r.searchParams.set("redirect_uri",this.RedirectURI),r.searchParams.set("scope",e.join(" ")),r.searchParams.set("state",o),r.searchParams.set("code_challenge",this.base64url(await this.sha256(t))),r.searchParams.set("code_challenge_method","S256");let i=await de.default.tabs.create({url:r.toString()});if(!i.id)throw new Error("Missing tab id");let a=await this.getResponseUrl(i.id);if(a.searchParams.get("state")!==o)throw new Error("Failed to verify state parameter from URL fragment");let p=a.searchParams.get("code");if(!p)throw new Error("Failed to receive code");let u=new URL("oauth/token/",se.ITADServer),x=new URLSearchParams;x.set("grant_type","authorization_code"),x.set("client_id",se.ITADClientId),x.set("redirect_uri",this.RedirectURI),x.set("code",p),x.set("code_verifier",t);let L=await(await fetch(u,{method:"POST",body:x})).json(),E=L.access_token,D=L.expires_in;if(!E||!D)throw new Error("Authorization failed");await W.create(E,Number(D))}};var mr=250,ps=["wait_read","wait_write","coll_read","coll_write","notes_read","notes_write"],tt=class extends ee{constructor(){super(se.ITADApiServerHost)}async fetchStoreList(){let e=this.getUrl("service/shops/v1"),t=await this.fetchJson(e);if(!Array.isArray(t))throw new Error("Can't read store list from response");return t.map(o=>({id:o.id,title:o.title}))}async fetchSteamIds(e){let t=this.getUrl("lookup/shop/61/id/v1"),o=await this.fetchJson(t,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}),r=new Map;for(let[i,a]of Object.entries(o))if(a!==null)for(let p of a)r.set(p,i);return r}async fetchGameIds(e){let t=this.getUrl("lookup/id/shop/61/v1"),o=await this.fetchJson(t,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}),r=new Map;for(let[i,a]of Object.entries(o))a!==null&&r.set(i,a);return r}async fetchCollection(){let e=await W.load();if(!e)return null;let t=await this.fetchJson(this.getUrl("/collection/games/v1"),{headers:{authorization:"Bearer "+e}});if(t.length===0)return null;let o=new Map;for(let p of t)o.set(p.id,[]);let r=await this.fetchJson(this.getUrl("/collection/copies/v1"),{headers:{authorization:"Bearer "+e}});for(let p of r){let u=p.game.id,x={redeemed:p.redeemed};p.shop&&(x.shop=p.shop.name),p.note&&(x.note=p.note),p.tags.length>0&&(x.tags=p.tags.map(k=>k.tag)),o.get(u)?.push(x)}let i=await this.fetchSteamIds([...o.keys()]),a=new Map;for(let[p,u]of i.entries())a.set(p,o.get(u)??[]);return a}async fetchWaitlist(){let e=await W.load();if(!e)return null;let t=this.getUrl("/waitlist/games/v1"),o=await this.fetchJson(t,{headers:{authorization:"Bearer "+e}});if(o.length===0)return null;let r=o.map(i=>i.id);return await this.fetchSteamIds(r)}async getStoreList(){if(await c.isStoreExpired("storeList")){let e=await this.fetchStoreList();return await c.replaceAll("storeList",e.map(t=>[t.id,t])),await c.setStoreExpiry("storeList",7*86400),e}else return await c.db.getAll("storeList")}async isConnected(){return await W.load()!==null}async disconnect(){return await W.clear(),await P.remove("lastItadImport"),c.clear("collection","waitlist","itadImport")}async getLastImport(){return await P.get("lastItadImport")??{from:null,to:null}}async recordLastImport(){let e=await this.getLastImport();e.from=S.now(),await P.set("lastItadImport",e)}async removeFromWaitlist(e){let t=await W.load();if(!t)throw new Error("Missing access token");if(e.length===0)throw new Error("Can't remove nothing from ITAD Waitlist!");let o=e.map(i=>`app/${i}`),r=await Promise.all(o.map(i=>c.get("waitlist",i)));if(r=r.filter(i=>i),r.length>0){let i=this.getUrl("waitlist/games/v1"),a=await fetch(i,{method:"DELETE",headers:{authorization:"Bearer "+t},body:JSON.stringify(r)});if(!a.ok)throw new O.HTTPError(a.status,a.statusText);return c.delete("waitlist",...o)}}async addToWaitlist(e){let t=await W.load();if(!t)throw new Error("Missing access token");let o=e.map(i=>`app/${i}`),r=await this.fetchGameIds(o);if(r.size!==0){let i=await fetch(new URL("waitlist/games/v1",se.ITADApiServerHost),{method:"PUT",headers:{authorization:"Bearer "+t},body:JSON.stringify(Array.from(r.values()))});if(!i.ok)throw new O.HTTPError(i.status,i.statusText);return c.putMany("waitlist",[...r])}}async addToCollection(e,t){let o=await W.load();if(!o)throw new Error("Missing access token");let r=[...e.map(a=>`app/${a}`),...t.map(a=>`sub/${a}`)];if(r.length===0)return;let i=await this.fetchGameIds(r);if(i.size!==0&&(await fetch(new URL("collection/games/v1",se.ITADApiServerHost),{method:"PUT",headers:{authorization:"Bearer "+o},body:JSON.stringify(Array.from(i.values()))})).ok)return c.putMany("collection",[...i.keys()].map(p=>[p,[]]))}async exportToItad(e){if(e)await c.clear("dynamicStore");else{let D=await this.getLastImport();if(D.to&&S.isInPast(D.to+15*60))return}let o=c.db.transaction(["dynamicStore","itadImport"]),r=o.objectStore("dynamicStore"),i=o.objectStore("itadImport"),a=[],p=[],u=[],x=[],k=[],L=[];if(I.itad_sync_library){let D=new Set(await i.get("lastOwnedApps")??[]),re=new Set(await i.get("lastOwnedPackages")??[]);a=await r.get("ownedApps")??[],p=await r.get("ownedPackages")??[],x=a.filter(ge=>!D.has(ge)),k=p.filter(ge=>!re.has(ge))}if(I.itad_sync_wishlist){let D=new Set(await i.get("lastWishlisted")??[]);u=await r.get("wishlisted")??[],L=u.filter(re=>!D.has(re))}await o.done;let E=[];if((x.length>0||k.length>0)&&E.push((async()=>{await this.addToCollection(x,k),await c.putMany("itadImport",[["lastOwnedApps",a],["lastOwnedPackages",p]])})()),L.length>0&&E.push((async()=>{await this.addToWaitlist(L),await c.put("itadImport",u,"lastWishlisted")})()),await Promise.all(E),E.length>0){let D=await this.getLastImport();D.to=S.now(),await P.set("lastItadImport",D)}}async importWaitlist(e){if(I.itad_sync_wishlist&&(e||await c.isStoreExpired("waitlist"))){let t=await this.fetchWaitlist();await c.replaceAll("waitlist",t?[...t.entries()]:[]),await c.setStoreExpiry("waitlist",S.now()+15*60),await this.recordLastImport()}}async importCollection(e){if(I.itad_sync_library&&(e||await c.isStoreExpired("collection"))){let t=await this.fetchCollection();await c.replaceAll("collection",t?[...t.entries()]:[]),await c.setStoreExpiry("collection",S.now()+15*60),await this.recordLastImport()}}async sync(e){await this.exportToItad(e),await this.importWaitlist(e),await this.importCollection(e),I.itad_sync_notes&&await this.pullNotes()}async inWaitlist(e){return await this.importWaitlist(!1),c.contains("waitlist",e)}async inCollection(e){return await this.importCollection(!1),c.contains("collection",e)}async getFromCollection(e){return await this.importCollection(!1),await c.get("collection",e)??null}async pullNotes(){let e=await W.load();if(!e)throw new O.OAuthUnauthorized;let t=await this.fetchJson(this.getUrl("/user/notes/v1"),{method:"GET",headers:{authorization:"Bearer "+e,accept:"application/json"}}),o=new Map(t.map(a=>[a.gid,a.note])),r=await this.fetchSteamIds([...o.keys()]),i=[];for(let[a,p]of r){if(!a.startsWith("app/"))continue;let u=Number(a.substring(4));i.push([u,o.get(p)])}return i}async pushNotes(e){let t=await W.load();if(!t)throw new O.OAuthUnauthorized;let o={pushed:0,errors:[]};if(e.length===0)return o;let r=new Map(e),i=[...r.keys()].map(u=>`app/${u}`),a=await this.fetchGameIds(i),p=[];for(let[u,x]of r.entries()){if(x=x.trim(),x===""){o.errors.push([u,$o,null]);continue}if(x.length>mr){o.errors.push([u,Yo,{length:x.length,max:mr}]);continue}let k=a.get(`app/${u}`)??null;if(k===null){o.errors.push([u,Jo,null]);continue}p.push({gid:k,note:x})}if(p.length!==0){let u=await fetch(this.getUrl("/user/notes/v1"),{method:"PUT",headers:{authorization:"Bearer "+t,"content-type":"application/json",accept:"application/json"},body:JSON.stringify(p)});if(!u.ok)throw new O.HTTPError(u.status,u.statusText)}return o.pushed=p.length,o}async deleteNotes(e){let t=await W.load();if(!t)throw new O.OAuthUnauthorized;let o=await this.fetchGameIds(e.map(i=>`app/${i}`)),r=await fetch(this.getUrl("/user/notes/v1"),{method:"DELETE",headers:{authorization:"Bearer "+t,"content-type":"application/json"},body:JSON.stringify([...o.values()])});if(!r.ok)throw new O.HTTPError(r.status,r.statusText)}handle(e){switch(e.action){case"itad.storelist":return this.getStoreList();case"itad.authorize":return new et().authorize(ps);case"itad.disconnect":return this.disconnect();case"itad.isconnected":return this.isConnected();case"itad.export":return this.exportToItad(e.params.force);case"itad.sync":return this.sync(e.params.force);case"itad.lastimport":return this.getLastImport();case"itad.inwaitlist":return this.inWaitlist(e.params.storeIds);case"itad.addtowaitlist":return this.addToWaitlist(e.params.appids);case"itad.removefromwaitlist":return this.removeFromWaitlist(e.params.appids);case"itad.incollection":return this.inCollection(e.params.storeIds);case"itad.getfromcollection":return this.getFromCollection(e.params.storeId);case"itad.notes.pull":return this.pullNotes();case"itad.notes.push":return this.pushNotes(e.params.notes);case"itad.notes.delete":return this.deleteNotes(e.params.appids)}return z}};var ot=class extends ee{constructor(){super(se.ApiServerHost)}fetchStorePageData(e){let t=this.getUrl(`app/${e}/v2`);return this.fetchJson(t)}fetchRates(e){let t=this.getUrl("rates/v1",{to:e.join(",")});return this.fetchJson(t)}fetchEarlyAccess(){let e=this.getUrl("early-access/v1");return this.fetchJson(e)}fetchSteamPeek(e){let t=this.getUrl(`similar/${e}/v2`,{count:15});return this.fetchJson(t)}fetchDlcInfo(e){let t=this.getUrl(`dlc/${e}/v2`);return this.fetchJson(t)}fetchProfile(e){let t=this.getUrl(`profile/${e}/v2`);return this.fetchJson(t)}fetchTwitch(e){let t=this.getUrl(`twitch/${e}/stream/v2`);return this.fetchJson(t)}fetchProfileBackgrounds(e){let t=this.getUrl("profile/background/list/v2",{appid:e});return this.fetchJson(t)}fetchProfileBackgroundsGames(){let e=this.getUrl("profile/background/games/v1");return this.fetchJson(e)}fetchMarketCardPrices(e,t){let o=this.getUrl("market/cards/v2",{currency:e,appid:t});return this.fetchJson(o)}fetchMarketAverageCardPrices(e,t){let o=this.getUrl("market/cards/average-prices/v2",{currency:e,appids:t.join(",")});return this.fetchJson(o)}fetchPrices(e,t,o,r,i,a){let p=this.getUrl("prices/v2");return this.fetchJson(p,{method:"POST",body:JSON.stringify({country:e,apps:t,subs:o,bundles:r,voucher:i,shops:a})})}async getProfileData(e){let o=await c.get("profiles",e);return(!o||S.isInPast(o.expiry))&&(o={data:await this.fetchProfile(e),expiry:S.now()+86400},await c.put("profiles",o,e)),o.data}clearOwn(e){return c.delete("profiles",e)}async getStorePageData(e){let o=await c.get("storePageData",e);return(!o||S.isInPast(o.expiry))&&(o={data:await this.fetchStorePageData(e),expiry:S.now()+3600},await c.put("storePageData",o,e)),o.data}expireStorePageData(e){return c.delete("storePageData",e)}async getRates(e){let o=e.join(","),r=await c.get("rates",o);return(!r||S.isInPast(r.expiry))&&(r={data:await this.fetchRates(e),expiry:S.now()+3600},await c.put("rates",r,o)),r.data}clearRates(){return c.clear("rates")}async isEarlyAccess(e){if(await c.isStoreExpired("earlyAccessAppids")){let r=await this.fetchEarlyAccess();await c.replaceAll("earlyAccessAppids",r.map(i=>[i,i])),await c.setStoreExpiry("earlyAccessAppids",7200)}return c.contains("earlyAccessAppids",e)}handle(e){switch(e.action){case"prices":{let{country:t,apps:o,subs:r,bundles:i,voucher:a,shops:p}=e.params;return this.fetchPrices(t,o,r,i,a,p)}case"dlcinfo":return this.fetchDlcInfo(e.params.appid);case"storepagedata":return this.getStorePageData(e.params.appid);case"storepagedata.expiry":return this.expireStorePageData(e.params.appid);case"rates":return this.getRates(e.params.to);case"clearrates":return this.clearRates();case"isea":return this.isEarlyAccess(e.params.appids);case"profile.background":return this.fetchProfileBackgrounds(e.params.appid);case"profile.background.games":return this.fetchProfileBackgroundsGames();case"twitch.stream":return this.fetchTwitch(e.params.channelId);case"market.cardprices":return this.fetchMarketCardPrices(e.params.currency,e.params.appid);case"market.averagecardprices":return this.fetchMarketAverageCardPrices(e.params.currency,e.params.appids);case"steampeek":return this.fetchSteamPeek(e.params.appid);case"profile":return this.getProfileData(e.params.steamId);case"clearownprofile":return this.clearOwn(e.params.steamId)}return z}};var rt=class{getNote(e){return c.getObject("notes",e)}async setNote(e,t){await c.put("notes",t,e)}deleteNote(e){return c.delete("notes",e)}async getAllNotes(){let t=await c.db.transaction("notes").store.openCursor(),o={};for(;t;)o[t.key]=t.value,t=await t.continue();return o}async setAllNotes(e){return await this.clearNotes(),c.putMany("notes",Object.entries(e).map(([t,o])=>[Number(t),o]))}clearNotes(){return c.clear("notes")}handle(e){switch(e.action){case"notes.get":return this.getNote(e.params.appids);case"notes.set":return this.setNote(e.params.appid,e.params.note);case"notes.delete":return this.deleteNote(e.params.appid);case"notes.getall":return this.getAllNotes();case"notes.setall":return this.setAllNotes(e.params.notes);case"notes.clear":return this.clearNotes()}return z}};var oo=te(oe());var Ue=class{static fromUrl(e){let t=e.match(/(?:store\.steampowered|steamcommunity)\.com\/(?:app|games|market\/listings)\/(\d+)\/?/);return t&&t[1]!==void 0?Number(t[1]):null}static fromCDNUrl(e){let t=/(?:cdn\.(?:akamai|cloudflare)\.steamstatic\.com\/steam|steamcdn-a\.akamaihd\.net\/steam|steamcommunity\/public\/images)\/apps\/(\d+)\//,o=/shared\.(?:akamai|cloudflare)\.steamstatic\.com\/store_item_assets\/steam\/apps\/(\d+)\//,r=e.match(t)??e.match(o);return r&&r[1]!==void 0?Number(r[1]):null}static fromGameCardUrl(e){let t=e.match(/\/gamecards\/(\d+)/);return t&&t[1]!==void 0?Number(t[1]):null}static fromElement(e){if(!e)return null;let t=e.dataset.dsAppid;if(t)return Number(t);let o=e.getAttribute("href");return o?this.fromUrl(o):null}static fromImageElement(e){if(!e)return null;let t=e.getAttribute("src");return t?this.fromCDNUrl(t):e.dataset.imageUrl?this.fromCDNUrl(e.dataset.imageUrl):null}static fromText(e){let t=/(?:store\.steampowered|steamcommunity)\.com\/app\/(\d+)\/?/g,o=[],r;for(;(r=t.exec(e))!==null;)o.push(Number(r[1]));return o}};var st=class extends ee{constructor(){super("https://steamcommunity.com/")}async loadInventory(e){let t=await P.get("login");if(!t||!t.steamId)return console.warn("Must be signed in to access Inventory"),null;let o=null,r=new URL(`/inventory/${t.steamId}/753/${e}`,"https://steamcommunity.com/");r.searchParams.set("l","english"),r.searchParams.set("count","2000");let i=!1;do{i=!1;let a=await fetch(r,{credentials:"include"});if(!a.ok)throw a.status===403?new O.LoginError("community"):new O.HTTPError(a.status,a.statusText);let p=await a.json();p&&p.success&&(o||(o={assets:[],descriptions:[]}),p.assets&&o.assets.push(...p.assets),p.descriptions&&o.descriptions.push(...p.descriptions),p.last_assetid&&r.searchParams.set("start_assetid",p.last_assetid),p.more_items&&(i=!0))}while(i);if(!o)throw new Error(`Could not retrieve Inventory 753/${e}`);return o}async fetchCoupons(){let e=await this.loadInventory(3);if(!e)return null;let t=new Map;for(let r of e.descriptions){if(!r.type||r.type!=="Coupon"||!r.actions)continue;let i={appids:[],image_url:r.icon_url,title:r.name,discount:Number(r.name.match(/([1-9][0-9])%/)[1]),id:`${r.classid}_${r.instanceid}`};r.descriptions.forEach((a,p)=>{let u=a.value;u.startsWith("Can't be applied with other discounts.")?(i.discount_note=u,i.discount_note_id=p,i.discount_doesnt_stack=!0):u.startsWith("(Valid")&&(i.valid_id=p,i.valid=u)});for(let a of r.actions){let p=a.link.match(/[1-9][0-9]*(?:,[1-9][0-9]*)*/);if(!p){console.warn("Couldn't find packageid(s) for link %s",a.link);continue}for(let u of p[0].split(",")){let x=Number(u);(!t.has(x)||t.get(x).discount<i.discount)&&t.set(x,i)}}}let o=await new Pe().getPackageApps([...t.keys()]);for(let[r,i]of t.entries())i.appids=o.get(r)??[];return t}async fetchGiftsAndPasses(){let e=await this.loadInventory(1);if(!e)return null;let t=[],o=[],r=!1;for(let i of e.descriptions){let a=i.descriptions?.find(p=>p.type==="html");if(a){let p=Ue.fromText(a.value);if(p.length>0){r=!0;for(let u of p)i.type==="Gift"?t.push(u):o.push(u)}}if(!r&&i.actions&&i.actions.length>1){let p=Ue.fromUrl(i.actions[0].link);p&&(i.type==="Gift"?t.push(p):o.push(p))}}return{gifts:t,passes:o}}async fetchItems(){let e=await this.loadInventory(6);return e?e.descriptions.map(t=>t.market_hash_name):null}async refreshCoupons(){return this.refreshCouponsPromise||(this.refreshCouponsPromise=(async()=>{if(await c.isStoreExpired("coupons")){let t=await this.fetchCoupons();t===null?await c.clear("coupons"):(await c.replaceAll("coupons",[...t.entries()]),await c.setStoreExpiry("coupons",60*60))}})()),this.refreshCouponsPromise}async getCoupon(e){return await this.refreshCoupons(),c.getFromIndex("coupons","idx_appid",e)}async getCouponsAppids(e){await this.refreshCoupons();let t=c.db.transaction("coupons"),o=new Set(await t.store.index("idx_appid").getAllKeys()),r=[];for(let i of e)o.has(i)&&r.push("app/"+i);return await t.done,r}async refreshGiftsAndPasses(){return this.refreshGiftsPromise||(this.refreshGiftsPromise=(async()=>{if(await c.isStoreExpired("giftsAndPasses")){let t=await this.fetchGiftsAndPasses();t===null?await c.clear("giftsAndPasses"):(await c.replaceAll("giftsAndPasses",[["gifts",t.gifts],["passes",t.passes]]),await c.setStoreExpiry("giftsAndPasses",60*60))}})()),this.refreshGiftsPromise}async getGiftsAppids(e){await this.refreshGiftsAndPasses();let t=c.db.transaction("giftsAndPasses"),o=new Set(await t.store.get("gifts")??[]),r=[];for(let i of e)o.has(i)&&r.push("app/"+i);return await t.done,r}async getPassesAppids(e){await this.refreshGiftsAndPasses();let t=c.db.transaction("giftsAndPasses"),o=new Set(await t.store.get("passes")??[]),r=[];for(let i of e)o.has(i)&&r.push("app/"+i);return await t.done,r}async hasItem(e){if(await c.isStoreExpired("items")){let o=await this.fetchItems();o===null?await c.clear("items"):(await c.replaceAll("items",o.map(r=>[r,r])),await c.setStoreExpiry("items",60*60))}return await c.contains("items",e)}handle(e){switch(e.action){case"inventory.coupon":return this.getCoupon(e.params.appid);case"inventory.getCouponAppids":return this.getCouponsAppids(e.params.appids);case"inventory.getGiftsAppids":return this.getGiftsAppids(e.params.appids);case"inventory.getPassesAppids":return this.getPassesAppids(e.params.appids);case"inventory.hasItem":return this.hasItem(e.params.hashes)}return z}};var Be=class{async clearCache(){await P.remove("currency"),await c.clear("coupons","giftsAndPasses","items","earlyAccessAppids","purchases","dynamicStore","packages","profiles","rates","collection","waitlist","itadImport","workshopFileSizes","reviews","storeList","storePageData","expiries")}handle(e){switch(e.action){case"cache.clear":return this.clearCache()}return z}};var nt=class s{constructor(e,t=0,o=0){console.assert([e,t,o].filter(Number.isInteger).length===3,`${e}.${t}.${o} must be integers`),this.major=e,this.minor=t,this.patch=o}static from(e){if(e instanceof s)return new s(e.major,e.minor,e.patch);if(typeof e=="string")return s.fromString(e);if(Array.isArray(e))return s.fromArray(e);throw new Error(`Could not construct a Version from ${e}`)}static fromArray(e){if(e.length===0)throw new Error;return new s(Number(e[0]),Number(e[1]??0),Number(e[2]??0))}static fromString(e){return s.fromArray(e.split("."))}static coerce(e){return e instanceof s?e:s.from(e)}toString(){return`${this.major}.${this.minor}.${this.patch}`}toArray(){return[this.major,this.minor,this.patch]}toJSON(){return this.toString()}isCurrent(){return this.isSameOrAfter(Le.version)}isSame(e){let t=s.coerce(e);return this.major===t.major&&this.minor===t.minor&&this.patch===t.patch}isBefore(e){let t=s.coerce(e);return this.major<t.major?!0:this.major>t.major?!1:this.minor<t.minor?!0:this.minor>t.minor?!1:this.patch<t.patch}isSameOrBefore(e){return this.isSame(e)||this.isBefore(e)}isAfter(e){return s.coerce(e).isBefore(this)}isSameOrAfter(e){return s.coerce(e).isSameOrBefore(this)}};var it=class{static async migrate(e){let t=new ve;if(e.isSameOrBefore("2.0.0")&&(await t.remove("showfakeccwarning"),await t.remove("hideaboutlinks")),e.isSameOrBefore("2.0.1")){await t.remove("hide_dlcunownedgames"),await t.remove("hide_wishlist"),await t.remove("hide_cart"),await t.remove("hide_notdiscounted"),await t.remove("hide_mixed"),await t.remove("hide_negative"),await t.remove("hide_priceabove"),await t.remove("priceabove_value"),await t.remove("hide_owned"),await t.remove("hide_ignored"),await t.remove("highlight_notdiscounted"),await t.remove("showallfriendsthatown");let o=t.get("showusernotes");o!==void 0&&(await K.set("user_notes_app",!!o),await K.set("user_notes_wishlist",!!o),await t.remove("showusernotes"))}if(e.isSameOrBefore("2.1.0")){await t.remove("showcomparelinks");let o=await t.get("profile_custom_link");for(let r of o)r.url&&!r.url.includes("[ID]")&&(r.url+="[ID]");await K.set("profile_custom_link",o)}if(e.isSameOrBefore("2.3.3")){let o=await t.get("customize_apppage");for(let r of["steamchart","surveys","steamspy"])Object.prototype.hasOwnProperty.call(o,r)&&typeof o[r]=="boolean"&&delete o[r];await K.set("customize_apppage",o)}if(e.isSameOrBefore("2.4.1")&&await t.remove("showallachievements"),e.isSameOrBefore("2.5.0")&&await t.remove("replaceaccountname"),e.isSameOrBefore("3.0.0")){let o={adventureshop:1,allyouplay:2,amazonus:3,battlenet:4,bistore:5,bundlestars:6,coinplay:7,cybermanta:8,desura:9,digitaldownload:10,direct2drive:11,discord:12,dlgamer:13,dotemu:14,dreamgame:15,epic:16,fireflower:17,funstock:18,game2:19,gamebillet:20,gamefly:21,gamejolt:22,gameolith:23,gamersgate:24,gamesload:25,gamesplanet:26,gamesplanetde:27,gamesplanetfr:28,gamesplanetus:29,gamesrepublic:30,gamesrocket:31,gametap:32,gemly:33,getgames:34,gog:35,greenmangaming:36,humblestore:37,humblewidgets:38,chrono:39,imperialgames:40,impulse:41,indiegalastore:42,indiegamestand:43,itchio:44,lbostore:45,less4games:46,macgamestore:47,microsoft:48,newegg:49,nuuvem:50,oculus:51,origin:52,paradox:53,playfield:54,playism:55,razer:56,savemi:57,shinyloot:58,silagames:59,squenix:60,steam:61,uplay:62,voidu:63,wingamestore:64,joybuggy:65,noctre:66,etailmarket:67},r=await t.get("excluded_stores");await K.set("excluded_stores",r.map(i=>o[i]??null).filter(i=>i))}e.isSameOrBefore("3.1.0")&&(await t.remove("addtocart_no_redirect"),await t.remove("show_steamspy_info"),await t.remove("show_survey_info"),await t.remove("show_steamchart_info")),e.isSameOrBefore("4.0.1")&&(await K.set("itad_sync_library",await t.get("itad_import_library")??!0),await K.set("itad_sync_wishlist",await t.get("itad_import_wishlist")??!0),await t.remove("itad_import_library"),await t.remove("itad_import_wishlist"),await W.clear())}};ue.CurrentContext=1;var z=Symbol("Unrecognized");oo.default.runtime.onInstalled.addListener(async s=>{if(s.reason!=="update"||s.previousVersion===void 0)return;let e=nt.fromString(s.previousVersion);await c.init(),await it.migrate(e),await new Be().handle("cache.clear"),console.log("Update done")});oo.default.runtime.onMessage.addListener((s,e)=>{if(!(!e||!e.tab)&&!(!s||!s.action))return(async()=>{try{await Promise.all([c.init(),K.init()]);let t,o=[new ot,new Qe,new st,new tt,new Pe,new rt,new Be];for(let r of o)if(t=await r.handle(s),t!==z)break;if(t===z)throw new Error("Unknown message");return t}catch(t){throw console.group(`Callback: "${s.action}"`),console.error("Failed to execute %o",s),console.error(t),console.groupEnd(),new Error(t.toString())}})()});Xe.register();return Zr(ls);})();
/*! Bundled license information:

dompurify/dist/purify.js:
  (*! @license DOMPurify 3.0.9 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.0.9/LICENSE *)
*/
//# sourceMappingURL=background.js.map
